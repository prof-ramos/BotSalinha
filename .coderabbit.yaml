# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json

language: 'pt-BR'

early_access: false

reviews:
  profile: 'chill'

  request_changes_workflow: false
  high_level_summary: true
  poem: false
  review_status: true
  collapse_walkthrough: false

  auto_review:
    enabled: true
    drafts: false
    base_branches:
      - main
      - develop

  path_instructions:
    - path: 'src/**/*.py'
      instructions: |
        Revise o código Python seguindo as melhores práticas para Python 3.12+.
        Verifique:
        - Type hints em todas as funções e métodos
        - Docstrings no formato Google/PEP 257
        - Uso de early returns para melhor legibilidade
        - Código síncrono vs assíncrono (usar async quando apropriado)
        - Tratamento de erros com exceções customadas
        - Logs estruturados com structlog

    - path: 'tests/**/*.py'
      instructions: |
        Revise os testes pytest garantindo:
        - Uso de fixtures do conftest.py
        - Mocks para APIs externas (Discord, Gemini)
        - Testes de happy path e error cases
        - Nomenclatura descritiva: test_<func>_<scenario>_<expected>
        - Cobertura adequada de edge cases

    - path: 'migrations/**/*.py'
      instructions: |
        Revise as migrações Alembic verificando:
        - Compatibilidade com SQLite
        - Reversibilidade das migrações (downgrade)
        - Nomenclatura consistente

    - path: 'scripts/**/*.py'
      instructions: |
        Revise scripts utilitários focando em:
        - Tratamento de erros robusto
        - Logs informativos para operações
        - Argparse para argumentos CLI quando necessário

  tools:
    ruff:
      enabled: true

    gitleaks:
      enabled: true

    markdownlint:
      enabled: true

    shellcheck:
      enabled: true

code_generation:
  docstrings:
    language: 'pt-BR'
    path_instructions:
      - path: 'src/**/*.py'
        instructions: |
          Gere docstrings no formato Google com:
          - Descrição clara do propósito
          - Args com tipos e descrições
          - Returns com tipo e descrição
          - Raises para exceções lançadas
          - Exemplos de uso quando relevante

chat:
  auto_reply: true

knowledge_base:
  opt_out: false

  learnings:
    scope: 'local'

  issues:
    scope: 'local'

  jira:
    usage: 'disabled'

  linear:
    usage: 'disabled'
