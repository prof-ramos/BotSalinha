# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json

language: "pt-BR"
early_access: false

reviews:
  profile: "chill"
  request_changes_workflow: false
  high_level_summary: true
  review_status: true
  review_details: false
  collapse_walkthrough: false
  poem: false
  changed_files_summary: true
  sequence_diagrams: false

  auto_review:
    enabled: true
    drafts: false
    base_branches:
      - main
      - develop

  path_filters:
    - "**/*.py"
    - "**/*.md"
    - "**/*.yml"
    - "**/*.yaml"
    - "!metricas/**/*.csv"
    - "!metricas/**/*.txt"
    - "!repomix-output.xml"
    - "!data/**"

  path_instructions:
    - path: "src/**/*.py"
      instructions: |
        Projeto Python 3.12+ com foco em async/await.
        Verifique:
        - Type hints corretos e coerentes com mypy strict
        - Tratamento de erro via hierarquia de exceções do projeto
        - Logging estruturado (structlog) e mensagens acionáveis
        - Separação de responsabilidades (config/core/storage/rag)
        - Evitar regressões de comportamento em comandos Discord

    - path: "tests/unit/**/*.py"
      instructions: |
        Priorize qualidade de testes unitários:
        - Isolamento (sem I/O real)
        - Mocks explícitos para APIs externas
        - Nomes de teste descritivos
        - Cobertura de casos de erro e edge cases

    - path: "tests/integration/**/*.py"
      instructions: |
        Para testes de integração:
        - Validar contratos entre camadas (core/storage/rag)
        - Evitar dependências externas reais
        - Garantir determinismo e baixa flakiness

    - path: "tests/e2e/**/*.py"
      instructions: |
        Em E2E:
        - Foque regressões de fluxo principal
        - Valide cenários de erro com mensagens úteis
        - Minimize acoplamento com estado global

    - path: "tests/load/**/*.py"
      instructions: |
        Em testes de carga:
        - Verifique estabilidade estatística das métricas
        - Evite asserts frágeis dependentes de latência variável
        - Garanta clareza nos relatórios de performance

    - path: "migrations/**/*.py"
      instructions: |
        Revisar migrações Alembic para:
        - Compatibilidade com SQLite
        - Upgrade/downgrade reversível
        - Nomenclatura consistente e segura

    - path: "scripts/**/*.py"
      instructions: |
        Em scripts utilitários:
        - Tratamento de erros robusto
        - Saídas/logs claros para operação
        - CLI amigável e previsível

    - path: "docs/**/*.md"
      instructions: |
        Em documentação:
        - Linguagem clara, objetiva e em PT-BR
        - Consistência com comportamento real do código
        - Comandos executáveis e atualizados

  tools:
    ruff:
      enabled: true
      config_file: "pyproject.toml"
    gitleaks:
      enabled: true
    markdownlint:
      enabled: true
    shellcheck:
      enabled: true

chat:
  auto_reply: true
  art: false

code_generation:
  docstrings:
    language: "pt-BR"
    path_instructions:
      - path: "src/**/*.py"
        instructions: |
          Gere docstrings em formato Google com:
          - Descrição objetiva do propósito
          - Args/Returns com tipos e contexto
          - Raises quando aplicável
          - Exemplo curto apenas quando realmente útil

knowledge_base:
  opt_out: false
  learnings:
    scope: "local"
  issues:
    scope: "local"
  jira:
    usage: "disabled"
  linear:
    usage: "disabled"
